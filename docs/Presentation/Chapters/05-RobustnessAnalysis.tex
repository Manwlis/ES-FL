\setlength{\parskip}{\baselineskip}
\section{Robustness Analysis}

\begin{frame}
	\huge Robustness Analysis
\end{frame}

\begin{frame}{Preamble}
	Goals:\\
	\begin{itemize}
	    \item Prove algorithmic soundness \& robustness of developed FL system
	    \item Discover the parameter space where FL is most efficient
	\end{itemize}
	
	Benchmark values:\\
	\begin{itemize}
	    \item Model accuracy
	    \item Dataset repetitions
	\end{itemize}
\end{frame}

% \begin{frame}{Client Fault Tolerance}
% 	\begin{minipage}{0.5\textwidth}
%         \begin{figure}
%             \begin{tikzpicture}
%                 \begin{axis}
%                     [
%                         xmin = 0,
%                         xmax = 21,
%                         xlabel = Dataset Repetitions,
%                         xtick = { 2 , 4 , ..., 20 },
%                         ylabel = Test Accuracy,
%                         legend pos = south east,
%                         thick,
%                         scale = 0.75,
%                         every node/.style = {transform shape},
%                         scaled x ticks = false,
%                         label style = { font=\footnotesize },
%                         tick label style = { font=\footnotesize } 
%                     ]
%                     \addplot table [ x=session , y=normal_operation ]{data/experiment5.dat};
%                     \addplot table [ x=session , y=faulty_client ]{data/experiment5.dat};
%                     \addplot[mark=*] coordinates {(2,0.823400020599365)} node[pin=0:{\footnotesize client disconnects}]{} ;
                    
%                     \addlegendentry{\footnotesize Normal operation}
%                     \addlegendentry{\footnotesize Faulty operation}
%                 \end{axis}
%             \end{tikzpicture}
%         \end{figure}
% 	\end{minipage}%
% 	\begin{minipage}{0.5\textwidth}
% 	    \hspace{0.35cm}Experiment with faulty clients
%     	\begin{itemize}
%     	    \item 6-layer CNN with \~ 420.000 variables
%     	    \item Federated SGD with IID datasets
%     	    \item client disconnects mid communication
%     	\end{itemize}
%     	\begin{table}[H]
%             \center
%             \small
%             \begin{tabular}
%                 { | l | c | c | }
%                 \hline
%                 parameters & normal op & faulty op\\\hline
%                 total clients   & 5 & 6\\\hline
%                 clients per GE  & 3 & 3\\\hline
%                 steps per GE    & 1 & 1\\\hline
%                 batch size      & 20 & 20\\\hline
%             \end{tabular}
%         \end{table}
% 	\end{minipage}%
% \end{frame}

% \begin{frame}{Learning Rate (LR) Decay}
% 	\begin{minipage}{0.4\textwidth}
%         \begin{table}[H]
%             \center
%             \begin{tabular}
%                 { | l | c | }
%                 \hline
%                 parameters & FedAvg\\\hline
%                 total clients   & 5\\\hline
%                 clients per GE  & 3\\\hline
%                 local epochs    & 1\\\hline
%                 steps per epoch & 600\\\hline
%                 batch size      & 20\\\hline
%                 initial LR      &  1e-2\\\hline
%             \end{tabular}
%         \end{table}
% 	\end{minipage}%
% 	\begin{minipage}{0.6\textwidth}
% 	    \hspace{0.35cm}Experiment with different LR decay values
%     	\begin{itemize}
%     	    \item 6-layer CNN with \~ 420.000 variables
%     	    \item Federated Averaging with IID datasets
%     	    \item Decay LR every participating GE
%     	    \item LR can differ across clients!
%     	\end{itemize}
% 	\end{minipage}%
% \end{frame}

% \begin{frame}{Learning Rate (LR) Decay}
% 	\begin{minipage}{0.5\textwidth}
%     	\begin{figure}[H]
%             \center
%             \begin{tikzpicture}
%                 \begin{axis}
%                     [
%                         xmin = 0,
%                         xmax = 50,
%                         ymin = 0.8,
%                         xlabel = GE,
%                         xtick = { 0 , 5 ,..., 50 },
%                         ylabel = Test Accuracy,
%                         legend pos = south east,
%                         scale = 0.75,
%                         no markers,
%                         label style = { font=\footnotesize },
%                         tick label style = { font=\footnotesize } 
%                     ]
%                     \addplot [blue] table [ x=GE , y={lr_decay=0.818649} ]{data/experiment8.dat};
%                     \addplot [red] table [ x=GE , y={lr_decay=0.9093245} ]{data/experiment8.dat};
%                     \addplot [green] table [ x=GE , y={lr_decay=0.95466225} ]{data/experiment8.dat};
%                     \addplot [yellow] table [ x=GE , y={lr_decay=0.977331125} ]{data/experiment8.dat};
%                     \addplot [black] table [ x=GE , y={no_decay} ]{data/experiment8.dat};
%                     \addplot[ domain=0:50 , mark=none , black , thin , dotted , samples=2 ] {0.92};
                    
%                     \addlegendentry{\footnotesize LR decay $\approx$ 0.819}
%                     \addlegendentry{\footnotesize LR decay $\approx$ 0.909}
%                     \addlegendentry{\footnotesize LR decay $\approx$ 0.955}
%                     \addlegendentry{\footnotesize LR decay $\approx$ 0.977}
%                     \addlegendentry{\footnotesize No decay}
%                 \end{axis}
%             \end{tikzpicture}
%         \end{figure}
	
% 	\end{minipage}%
% 	\begin{minipage}{0.5\textwidth}
%     	\begin{table}[H]
%             \center
%             \small
%             \begin{tabular}
%                 { | c | c | c | }
%                 \hline
%                 LR decay & Max accuracy & 0.92 @GE\\\hline
%                 0.819 & 0.913 & -\\\hline
%                 0.909 & 0.9232 & 30\\\hline
%                 0.955 & 0.9245 & 32\\\hline
%                 0.977 & 0.9245 & 27\\\hline
%                 No decay & 0.9224 & 34\\\hline
%             \end{tabular}
%             \caption*{Max accuracy \& GEs for target accuracy}
%         \end{table}
% 	\end{minipage}%
% \end{frame}

\begin{frame}{Client Participation}
	\begin{minipage}{0.4\textwidth}
        \begin{table}[H]
            \center
            % \small
            \begin{tabular}{ | l | c | }
                \hline
                parameters      & FedAvg \\\hline
                total clients   & 10 \\\hline
                % clients per GE  & 1 & 3 & 5 & 10\\\hline
                local epochs    & 1\\\hline
                steps per epoch & 300\\\hline
                batch size      & 20\\\hline
                initial LR      & 1e-2\\\hline
                LR decay        & 0.977\\\hline
            \end{tabular}
        \end{table}
	\end{minipage}%
	\begin{minipage}{0.6\textwidth}
	    \hspace{0.35cm}Experiment with different numbers of\newline\hspace*{0.35cm}participating clients per GE.
    	\begin{itemize}
    	    \item 6-layer CNN with $\sim$420.000 variables
    	    \item Federated Averaging with IID datasets
    	   % \item client disconnects mid communication
    	\end{itemize}
	\end{minipage}%
\end{frame}

\begin{frame}{Client Participation}
	\begin{minipage}{0.5\textwidth}
        \begin{figure}[H]
            \center
            \begin{tikzpicture}[baseline=(current axis.outer east)]
                \begin{axis}
                    [
                        xmin = 0,
                        xmax = 200,
                        ymin = 0.8,
                        xlabel = GE,
                        xtick = { 0 , 25 ,..., 200 },
                        ylabel = Test Accuracy,
                        legend pos = south east,
                        scale = 0.75,
                        no markers,
                        thin,
                        label style = { font=\footnotesize },
                        tick label style = { font=\footnotesize } 
                    ]
                    \addplot [black] table [ x=GE , y={client1} ]{data/experiment9.dat};
                    \addplot +[restrict x to domain=1:100] [red] table [ x=GE , y={client3} ]{data/experiment9.dat};
                    \addplot +[restrict x to domain=1:100] [green] table [ x=GE , y={client5} ]{data/experiment9.dat};
                    \addplot +[restrict x to domain=1:100] [blue] table [ x=GE , y={client10} ]{data/experiment9.dat};
                    \addplot [ domain=0:200 , mark=none , black , thin , dotted , samples=2 ] {0.92};
                    
                    \addlegendentry{\footnotesize 1 client per GE}
                    \addlegendentry{\footnotesize 3 clients per GE}
                    \addlegendentry{\footnotesize 5 clients per GE}
                    \addlegendentry{\footnotesize 10 clients per GE}
                    
                \end{axis}
            \end{tikzpicture}
        \end{figure}
	\end{minipage}%
	\begin{minipage}{0.5\textwidth}
    	\begin{table}[H]
            \center
            \small
            \begin{tabular}{ | c | c | c | }
                \hline
                client per GE & 0.92 @GE\\\hline
                1 & 159\\\hline
                3 & 61 (2.6$\times$)\\\hline
                5 & 46 (3.4$\times$)\\\hline
                10 & 51 (3.1$\times$)\\\hline
            \end{tabular}
            \caption*{GEs for target accuracy and relative speedup}
        \end{table}
	\end{minipage}%
\end{frame}


\begin{frame}{General Conclusions}
% FedAvg has a far better computation to communication ratio that FedSGD.
% 
Training with non-IID datasets can be done efficiently in a far narrower parameter space, and requires a lot more training rounds.

The most important parameter is the batch size. The convergence rate and final accuracy are dictated by it.

LR and its decay have a great impact, but they are depended on other factors.

Consuming the local datasets multiple times per GE can be beneficial or detrimental, depending on other factors.
\end{frame}